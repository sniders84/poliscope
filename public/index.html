<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Officials</title>
  <link rel="stylesheet" href="style.css?v=2025-12-17-0715" />
  <link rel="icon" href="favicon.ico" onerror="this.href='data:,';" />
  <style>
    body {
      margin: 0;
      background-color: #1f1f1f;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #2b2b2b;
      border-bottom: 1px solid #444;
      padding: 10px;
      position: sticky;
      top: 0;
      z-index: 900;
    }
    .header-left { flex: 0 0 auto; }
    #hamburger {
      font-size: 24px;
      background: none;
      border: 1px solid #444;
      color: #fff;
      cursor: pointer;
      border-radius: 6px;
      width: 40px;
      height: 40px;
      display: grid;
      place-items: center;
    }
    .header-center { flex: 1 1 auto; text-align: center; }
    .logo { max-height: 100px; width: auto; }
    #hamburger-menu {
      position: fixed;
      top: 0;
      left: -260px;
      width: 260px;
      height: 100%;
      background-color: #2b2b2b;
      transition: left 0.3s ease;
      z-index: 1000;
      border-right: 1px solid #444;
    }
    #hamburger-menu.open { left: 0; }
    #hamburger-menu ul { list-style: none; padding: 0; margin: 0; }
    #hamburger-menu li { border-bottom: 1px solid #444; }
    #hamburger-menu a {
      display: block;
      padding: 12px;
      color: #fff;
      text-decoration: none;
    }
    #hamburger-menu a:hover { background-color: #0066cc; }
  </style>
</head>

<body>

<header>
  <div class="header-left">
    <button id="hamburger" aria-label="Open menu">&#9776;</button>
  </div>
  <div class="header-center">
    <img src="assets/electorate-logo.png" alt="Logo" class="logo" style="max-height:200px;" />
  </div>
</header>

<nav id="hamburger-menu" aria-label="Primary">
  <ul>
    <li><a href="#startup-hub" onclick="showStartupHub()">Home Hub</a></li>
    <li><a href="#podcasts-shows" onclick="showPodcastsShows()">Podcasts & Shows</a></li>
    <li><a href="#learning-resources" onclick="showTab('learning-resources')">Learning Resources</a></li>
    <li><a href="#civic" onclick="showCivic()">Civic Intelligence</a></li>
    <li><a href="#polls" onclick="showPolls()">Polls & Elections</a></li>
    <li><a href="#my-officials" onclick="renderOfficials(selectedState || 'North Carolina', ''); showTab('my-officials')">My Officials</a></li>
    <li><a href="#ratings" onclick="showTab('ratings'); showRatings();">Ratings/Rankings</a></li>
    <li><a href="#voting" onclick="showVoting()">Voting</a></li>
    <li><a href="#citizenship" onclick="showCitizenship()">Citizenship/Immigration</a></li>
    <li><a href="#organizations" onclick="showOrganizations()">Political Groups</a></li>
    <li><a href="#community" onclick="showCommunity()">Community</a></li>
  </ul>
</nav>

<main>

  <section id="startup-hub" class="tab-content" style="display:none;">
    <h2>Home Hub</h2>

    <div id="national-networks" class="category-section">
      <h2>National Broadcasting Networks</h2>
      <div class="card-grid" id="network-cards">
        <!-- network cards unchanged -->
      </div>
    </div>

    <div id="feed-viewer" class="feed-viewer">
      <h3 id="feed-title">Select a network to view stories</h3>
      <div class="story-grid" id="feed-stories"></div>
    </div>

    <div id="world-news" class="hub-section">
      <h2>Global Politics &amp; World News</h2>
      <div id="world-news-carousel" class="carousel"></div>
    </div>

    <div id="finance-markets" class="hub-section">
      <h2>Finance &amp; Markets</h2>
      <div id="finance-carousel" class="carousel"></div>
    </div>

    <div id="economy" class="hub-section">
      <h2>Economy</h2>
      <div id="economy-carousel" class="carousel"></div>
    </div>

    <div id="popular-podcasts" class="category-section">
      <h2>Popular Podcasts</h2>
      <div class="card-grid"></div>
    </div>

    <div id="social-trends" class="hub-section">
      <h2>Trending Now</h2>
      <div id="social-feed" class="grid"></div>
    </div>
  </section>

  <section id="podcasts-shows" class="tab-content" style="display:none;">
    <h2>Podcasts & Shows</h2>
    <input
      type="text"
      id="podcasts-search-bar"
      class="search-bar"
      placeholder="Search podcasts or shows..."
    />
    <div id="podcasts-cards" class="grid"></div>
  </section>

</main>

</body>
</html>

    <section id="my-officials" class="tab-content" style="display: none; position: relative;">
  <h2>My Officials</h2>

  <div style="text-align: center; margin: 30px 0; padding: 20px; background: #2b2b2b; border-radius: 12px;">
    <label for="state-dropdown" style="font-size: 1.4rem; font-weight: bold; color: #fff; margin-right: 20px;">
      Select your state to view officials:
    </label>

    <select id="state-dropdown" style="padding: 12px 16px; font-size: 1.1rem; border-radius: 8px; background: #1f1f1f; color: #fff; border: 1px solid #444; min-width: 320px;">
      <option value="Alabama">Alabama</option>
      <option value="Alaska">Alaska</option>
      <option value="American Samoa">American Samoa</option>
      <option value="Arizona">Arizona</option>
      <option value="Arkansas">Arkansas</option>
      <option value="California">California</option>
      <option value="Colorado">Colorado</option>
      <option value="Connecticut">Connecticut</option>
      <option value="Delaware">Delaware</option>
      <option value="District of Columbia">District of Columbia</option>
      <option value="Florida">Florida</option>
      <option value="Georgia">Georgia</option>
      <option value="Guam">Guam</option>
      <option value="Hawaii">Hawaii</option>
      <option value="Idaho">Idaho</option>
      <option value="Illinois">Illinois</option>
      <option value="Indiana">Indiana</option>
      <option value="Iowa">Iowa</option>
      <option value="Kansas">Kansas</option>
      <option value="Kentucky">Kentucky</option>
      <option value="Louisiana">Louisiana</option>
      <option value="Maine">Maine</option>
      <option value="Maryland">Maryland</option>
      <option value="Massachusetts">Massachusetts</option>
      <option value="Michigan">Michigan</option>
      <option value="Minnesota">Minnesota</option>
      <option value="Mississippi">Mississippi</option>
      <option value="Missouri">Missouri</option>
      <option value="Montana">Montana</option>
      <option value="Nebraska">Nebraska</option>
      <option value="Nevada">Nevada</option>
      <option value="New Hampshire">New Hampshire</option>
      <option value="New Jersey">New Jersey</option>
      <option value="New Mexico">New Mexico</option>
      <option value="New York">New York</option>
      <option value="North Carolina" selected>North Carolina</option>
      <option value="North Dakota">North Dakota</option>
      <option value="Northern Mariana Islands">Northern Mariana Islands</option>
      <option value="Ohio">Ohio</option>
      <option value="Oklahoma">Oklahoma</option>
      <option value="Oregon">Oregon</option>
      <option value="Pennsylvania">Pennsylvania</option>
      <option value="Puerto Rico">Puerto Rico</option>
      <option value="Rhode Island">Rhode Island</option>
      <option value="South Carolina">South Carolina</option>
      <option value="South Dakota">South Dakota</option>
      <option value="Tennessee">Tennessee</option>
      <option value="Texas">Texas</option>
      <option value="Utah">Utah</option>
      <option value="Vermont">Vermont</option>
      <option value="Virgin Islands">U.S. Virgin Islands</option>
      <option value="Virginia">Virginia</option>
      <option value="Washington">Washington</option>
      <option value="West Virginia">West Virginia</option>
      <option value="Wisconsin">Wisconsin</option>
      <option value="Wyoming">Wyoming</option>
    </select>

    <input
      type="text"
      id="search-bar"
      placeholder="Search officials..."
      style="padding: 12px 16px; font-size: 1.1rem; border-radius: 8px; background: #1f1f1f; color: #fff; border: 1px solid #444; min-width: 320px; margin-left: 20px;"
    />
  </div>

  <div id="loading-overlay" style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.8);
    font-size: 1.5rem;
    font-weight: bold;
    z-index: 1000;
  ">
    Loading officials...
  </div>

  <div id="officials-container" class="grid"></div>
</section>

<section id="ratings" class="tab-content" hidden>
  <h2>Ratings & Rankings</h2>

  <div id="rr-toggle" class="rr-toggle" role="tablist" aria-label="Ratings & Rankings toggle">
    <button id="btn-ratings" class="rr-tab rr-tab-active" role="tab" aria-selected="true" aria-controls="ratings-section">
      Ratings
    </button>
    <button id="btn-rankings" class="rr-tab" role="tab" aria-selected="false" aria-controls="rankings-section">
      Rankings
    </button>
  </div>

  <div id="ratings-section" class="rr-section rr-section-active" role="tabpanel" aria-labelledby="btn-ratings">
    <div id="ratings-filters" class="filters-bar">
      <input type="text" id="searchInput" class="filter-select" placeholder="Search officials…" aria-label="Search officials" />
      <select id="officeFilter" class="filter-select" aria-label="Office filter">
        <option value="">All Offices</option>
        <option value="president">President</option>
        <option value="vice president">Vice President</option>
        <option value="governor">Governor</option>
        <option value="lieutenant governor">Lt. Governor</option>
        <option value="senator">Senator</option>
        <option value="u.s. representative">U.S. Representative</option>
      </select>
      <select id="stateFilter" class="filter-select" aria-label="State filter"></select>
      <select id="partyFilter" class="filter-select" aria-label="Party filter"></select>
    </div>
    <div id="ratings-cards" class="card-section"></div>
  </div>

  <div id="rankings-section" class="rr-section" role="tabpanel" aria-labelledby="btn-rankings" aria-hidden="true">
    <div class="filters-row">
      <select id="rankingsOfficeFilter" class="filter-select" aria-label="Rankings office filter">
        <option value="senator" selected>Senators</option>
        <option value="u.s. representative">House Reps</option>
        <option value="governor">Governors</option>
        <option value="lieutenant governor">Lt. Governors</option>
        <option value="president">President</option>
        <option value="vice president">Vice President</option>
      </select>
      <select id="rankingsCategoryFilter" class="filter-select" aria-label="Rankings category filter">
        <option value="overall" selected>Overall</option>
        <option value="sponsoredBills">Bills Sponsored</option>
        <option value="sponsoredAmendments">Amendments Sponsored</option>
        <option value="cosponsoredBills">Bills Cosponsored</option>
        <option value="cosponsoredAmendments">Amendments Cosponsored</option>
        <option value="becameLawBills">Laws Enacted (Sponsored)</option>
        <option value="becameLawCosponsoredBills">Laws Enacted (Cosponsored)</option>
        <option value="committees">Committees</option>
        <option value="missedVotes">Missed Votes</option>
      </select>
    </div>

    <div class="leaderboard-wrap">
      <table id="rankings-leaderboard" class="leaderboard-table" aria-label="Rankings leaderboard">
        <thead>
          <tr>
            <th scope="col" data-sort="rank">Rank</th>
            <th scope="col" data-sort="name">Official</th>
            <th scope="col" data-sort="office">Office</th>
            <th scope="col" data-sort="score">Power Score</th>
            <th scope="col" data-sort="streak">Streak</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="rankings-info">
      <button id="scoringLogicBtn" class="info-button" type="button">
        Rankings Scoring and Weight Logic
      </button>
    </div>
  </div>
</section>

<!-- Scorecard modal -->
<div id="scorecardModal" class="scorecard-modal" aria-hidden="true">
  <div class="scorecard-modal-content" role="dialog" aria-modal="true" aria-labelledby="scorecardName">
    <button id="scorecardClose" class="scorecard-modal-close" aria-label="Close scorecard" type="button">&times;</button>
    <div id="scorecardHeader" class="scorecard-header"></div>
    <h2 id="scorecardName"></h2>
    <table id="scorecardBreakdown" class="scorecard-table"></table>
  </div>
</div>

<!-- Scoring Logic modal -->
<div id="scoringLogicModal" class="scorecard-modal wide" aria-hidden="true">
  <div class="scorecard-modal-content" role="dialog" aria-modal="true" aria-labelledby="scoringLogicTitle">
    <button id="scoringLogicClose" class="scorecard-modal-close" aria-label="Close scoring logic" type="button">&times;</button>
    <h2 id="scoringLogicTitle">Rankings Scoring and Weight Logic</h2>
    <div id="scoringLogicBody" class="scoring-logic-body"></div>
  </div>
</div>

<script>
/* ---------- Sub-tabs: Ratings vs Rankings ---------- */
(() => {
  const ratingsTabBtn = document.getElementById('btn-ratings');
  const rankingsTabBtn = document.getElementById('btn-rankings');
  const ratingsSection = document.getElementById('ratings-section');
  const rankingsSection = document.getElementById('rankings-section');

  function activateTab(target) {
    const isRatings = target === 'ratings';
    ratingsTabBtn.classList.toggle('rr-tab-active', isRatings);
    rankingsTabBtn.classList.toggle('rr-tab-active', !isRatings);
    ratingsSection.classList.toggle('rr-section-active', isRatings);
    rankingsSection.classList.toggle('rr-section-active', !isRatings);
    ratingsSection.setAttribute('aria-hidden', String(!isRatings));
    rankingsSection.setAttribute('aria-hidden', String(isRatings));
  }

  if (ratingsTabBtn) ratingsTabBtn.addEventListener('click', () => activateTab('ratings'));
  if (rankingsTabBtn) rankingsTabBtn.addEventListener('click', () => activateTab('rankings'));
})();

/* ---------- Scoring logic modal content renderer ---------- */
function renderScoringLogic() {
  const modalBody = document.getElementById('scoringLogicBody');
  if (!modalBody) return;

  modalBody.innerHTML = `
    <p>
      Officials are ranked using weighted contributions from legislative and executive activity.
      Each category has a raw value, a weight, and a contribution (raw × weight).
      The sum of contributions forms the Power Score.
    </p>

    <h3>Legislative Offices</h3>
    <table class="scorecard-table">
      <thead><tr><th>Category</th><th>Weight</th><th>Rationale</th></tr></thead>
      <tbody>
        <tr><td>Bills Sponsored</td><td>1.2</td><td>Shows initiative.</td></tr>
        <tr><td>Amendments Sponsored</td><td>1.0</td><td>Refines legislation.</td></tr>
        <tr><td>Bills Cosponsored</td><td>0.6</td><td>Collaboration.</td></tr>
        <tr><td>Amendments Cosponsored</td><td>0.5</td><td>Cooperative input.</td></tr>
        <tr><td>Laws Enacted (Sponsored)</td><td>6.0</td><td>Turning proposals into law.</td></tr>
        <tr><td>Laws Enacted (Cosponsored)</td><td>4.0</td><td>Influence on lawmaking.</td></tr>
        <tr><td>Committee Memberships</td><td>4.0</td><td>Legislative influence.</td></tr>
        <tr><td>Committee Leadership</td><td>2.0</td><td>Added authority.</td></tr>
        <tr><td>Missed Votes (%)</td><td>-2.0</td><td>Penalizes absenteeism.</td></tr>
      </tbody>
    </table>

    <h3>Executive Offices</h3>
    <table class="scorecard-table">
      <thead><tr><th>Category</th><th>Weight</th><th>Rationale</th></tr></thead>
      <tbody>
        <tr><td>Executive Orders</td><td>2.5</td><td>Direct action.</td></tr>
        <tr><td>Vetoes</td><td>3.0</td><td>Blocking legislation.</td></tr>
        <tr><td>Budgets Proposed</td><td>2.0</td><td>Fiscal leadership.</td></tr>
        <tr><td>Appointments Confirmed</td><td>3.0</td><td>Staffing effectiveness.</td></tr>
        <tr><td>Leadership Score</td><td>5.0</td><td>Executive performance.</td></tr>
        <tr><td>Working With Legislature</td><td>3.5</td><td>Cross-branch cooperation.</td></tr>
        <tr><td>Crisis Response</td><td>4.0</td><td>Emergency handling.</td></tr>
        <tr><td>Missed Duties</td><td>-3.0</td><td>Neglect penalty.</td></tr>
        <tr><td>Misconduct</td><td>-12.0</td><td>Severe penalty.</td></tr>
      </tbody>
    </table>
  `;
}

/* ---------- Scorecard modal renderer ---------- */
function showScorecard(person, breakdown, composite) {
  const modal = document.getElementById('scorecardModal');
  if (!modal) return;

  const nameEl = document.getElementById('scorecardName');
  const table = document.getElementById('scorecardBreakdown');
  const header = document.getElementById('scorecardHeader');

  nameEl.textContent = person.name || 'Unknown';

  const photoUrl = person.photoUrl || '/assets/photos/fallback-photo.jpg';
  const district = person.district ? ` • District ${person.district}` : '';

  header.innerHTML = `
    <img src="${photoUrl}" alt="${person.name}" class="profile-photo" onerror="this.src='/assets/photos/fallback-photo.jpg';">
    <div class="scorecard-header-info">
      <p>${person.state || ''}${district} • ${person.party || 'N/A'}</p>
      <p>Office: ${person.office || 'N/A'}</p>
      <p>Power Score: ${Number(composite || 0).toFixed(1)}</p>
      <p>Streak: ${person.streak || 0} weeks</p>
    </div>
  `;

  table.innerHTML = `
    <tbody>
      <tr>
        <td colspan="4">
          <h3>Legislation</h3>
          <h3>Votes</h3>
          <h3>Committees</h3>
          <h3>Misconduct</h3>
        </td>
      </tr>
    </tbody>
  `;

  modal.classList.add('is-open');
  modal.setAttribute('aria-hidden', 'false');
}

/* ---------- Rankings table helpers ---------- */
function attachSortableHeaders(rows, officeType) {
  const headers = document.querySelectorAll('#rankings-leaderboard th[data-sort]');
  headers.forEach(header => {
    header.addEventListener('click', () => {
      const sortField = header.dataset.sort;
      const sortedRows = [...rows];

      if (sortField === 'rank') sortedRows.sort((a, b) => a.rank - b.rank);
      if (sortField === 'name') sortedRows.sort((a, b) => a.person.name.localeCompare(b.person.name));
      if (sortField === 'office') sortedRows.sort((a, b) => a.person.office.localeCompare(b.person.office));
      if (sortField === 'score') sortedRows.sort((a, b) => b.score - a.score);
      if (sortField === 'streak') sortedRows.sort((a, b) => b.streak - a.streak);

      renderTableBody(sortedRows, officeType);
    });
  });
}
</script>

function partyRowClass(party) {
  const p = (party || '').toLowerCase();
  if (p.includes('dem')) return 'row-dem';
  if (p.includes('rep')) return 'row-rep';
  return 'row-ind';
}

function renderTableBody(rows, officeType) {
  const tableBody = document.querySelector('#rankings-leaderboard tbody');
  if (!tableBody) return;

  tableBody.innerHTML = '';
  rows.forEach((row, idx) => {
    const tr = document.createElement('tr');
    tr.className = partyRowClass(row.person.party);
    tr.innerHTML = `
      <td>${idx + 1}</td>
      <td>
        <a href="#" class="scorecard-link" data-slug="${row.person.slug || ''}">
          ${row.person.name || 'Unknown'}
        </a>
        ${typeof renderMisconductBadge === 'function' ? renderMisconductBadge(row.person) : ''}
        <br><small>${row.person.state || ''} • ${row.person.party || 'N/A'}${officeType === 'rep' ? ` • District ${row.person.district || 'At-Large'}` : ''}</small>
      </td>
      <td>${row.person.office || 'N/A'}</td>
      <td>${row.score.toFixed(1)}</td>
      <td>${typeof renderStreakBadge === 'function' ? renderStreakBadge(row.streak) : (row.streak ?? 0)}</td>
    `;
    tableBody.appendChild(tr);
  });

  tableBody.querySelectorAll('.scorecard-link').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const slug = link.dataset.slug;
      const row = rows.find(r => r.person.slug === slug);
      if (row) {
        showScorecard(row.person, row.breakdown, row.score);
      }
    });
  });
}

/* ---------- Rankings render pipeline ---------- */
async function renderRankingsLeaderboard() {
  const officeSel = document.getElementById('rankingsOfficeFilter');
  const categorySel = document.getElementById('rankingsCategoryFilter');
  if (!officeSel || !categorySel) return;

  const selectedOffice = (officeSel.value || '').toLowerCase();
  const selectedCategory = categorySel.value;

  let senators = [];
  let reps = [];
  try {
    const data = await loadRankingsData();
    senators = data.senators || [];
    reps = data.reps || [];
  } catch (err) {
    console.error('Failed to load rankings data:', err);
  }

  let data = [];
  let officeType = 'senator';

  if (selectedOffice.includes('senator')) {
    data = senators;
    officeType = 'senator';
  } else if (selectedOffice.includes('representative') || selectedOffice.includes('rep')) {
    data = reps;
    officeType = 'rep';
  } else {
    document.querySelector('#rankings-leaderboard tbody').innerHTML =
      '<tr><td colspan="5">Select an office to view rankings</td></tr>';
    return;
  }

  if (!Array.isArray(data) || data.length === 0) {
    document.querySelector('#rankings-leaderboard tbody').innerHTML =
      '<tr><td colspan="5">No data loaded yet</td></tr>';
    return;
  }

  const rows = data.map((person, idx) => {
    const { composite, breakdown } = scoreLegislator(person);
    return {
      person,
      score: composite,
      breakdown,
      streak: person.streak || 0,
      rank: idx + 1
    };
  });

  let sortField = 'score';
  if (selectedCategory === 'sponsoredBills') sortField = 'sponsoredBills';
  else if (selectedCategory === 'sponsoredAmendments') sortField = 'sponsoredAmendments';
  else if (selectedCategory === 'cosponsoredBills') sortField = 'cosponsoredBills';
  else if (selectedCategory === 'cosponsoredAmendments') sortField = 'cosponsoredAmendments';
  else if (selectedCategory === 'becameLawBills') sortField = 'becameLawBills';
  else if (selectedCategory === 'becameLawCosponsoredBills') sortField = 'becameLawCosponsoredBills';
  else if (selectedCategory === 'committees') sortField = 'committees';
  else if (selectedCategory === 'missedVotes') sortField = 'missedVotes';

  rows.sort((a, b) => {
    const aVal = sortField === 'score' ? a.score : (a.person[sortField] ?? 0);
    const bVal = sortField === 'score' ? b.score : (b.person[sortField] ?? 0);
    return bVal - aVal;
  });

  renderTableBody(rows, officeType);
  attachSortableHeaders(rows, officeType);
}

/* ---------- Wire up filters, modals, initial render ---------- */
(() => {
  const officeSel = document.getElementById('rankingsOfficeFilter');
  const categorySel = document.getElementById('rankingsCategoryFilter');

  renderRankingsLeaderboard().catch(console.error);

  if (officeSel) officeSel.addEventListener('change', () => renderRankingsLeaderboard().catch(console.error));
  if (categorySel) categorySel.addEventListener('change', () => renderRankingsLeaderboard().catch(console.error));

  document.getElementById('scoringLogicBtn')?.addEventListener('click', () => {
    renderScoringLogic();
    const modal = document.getElementById('scoringLogicModal');
    if (modal) {
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden', 'false');
    }
  });

  document.getElementById('scoringLogicClose')?.addEventListener('click', () => {
    const modal = document.getElementById('scoringLogicModal');
    if (modal) {
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden', 'true');
    }
  });

  document.getElementById('scoringLogicModal')?.addEventListener('click', e => {
    if (e.target.id === 'scoringLogicModal') {
      e.target.classList.remove('is-open');
      e.target.setAttribute('aria-hidden', 'true');
    }
  });
})();

  // Scorecard modal close
  document.getElementById('scorecardClose')?.addEventListener('click', () => {
    const modal = document.getElementById('scorecardModal');
    if (modal) {
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden', 'true');
    }
  });

  document.getElementById('scorecardModal')?.addEventListener('click', e => {
    if (e.target.id === 'scorecardModal') {
      e.target.classList.remove('is-open');
      e.target.setAttribute('aria-hidden', 'true');
    }
  });
})();
</script>

<section id="learning-resources" class="tab-content" style="display: none;">
  <h2>Learning Resources</h2>

<!-- Civic Intelligence Tab -->
<section id="civic" class="tab-content" style="display: none;">
  <h2>Civic Intelligence Dashboard</h2>
  <div id="calendar"></div>
</section>

<!-- Polls & Elections Tab -->
<section id="polls" class="tab-content" style="display: none;">
  <h2>Polls & Elections</h2>

  <!-- Polls Subsection -->
  <div id="polls-cards" class="card-section">
    <!-- Poll cards will populate here via JS -->
  </div>

  <!-- Elections Subsection -->
  <div id="elections-cards" class="card-section">
    <!-- Election cards will populate here via JS -->
  </div>
</section>

<!-- Political Organizations Tab -->
<section id="organizations" class="tab-content" style="display: none;">
  <h2>Political Groups — Help Make a Difference!</h2>

  <!-- Featured Cards -->
  <div id="featured-political-cards" class="card-section">
    <div class="info-card">
      <img src="assets/political-parties.png" alt="Political Parties" class="card-image" />
      <h3>Political Parties</h3>
      <p>Explore the major parties shaping U.S. politics.</p>
      <a href="https://www.isidewith.com/parties" target="_blank" rel="noopener noreferrer" class="btn">View Parties</a>
    </div>

    <div class="info-card">
      <img src="assets/political-ideology.jpeg" alt="Political Ideologies" class="card-image" />
      <h3>Political Ideologies</h3>
      <p>Learn about the diverse ideologies influencing policy and debate.</p>
      <a href="https://www.isidewith.com/ideologies" target="_blank" rel="noopener noreferrer" class="btn">View Ideologies</a>
    </div>
  </div>

  <div class="organization-grid">
    <!-- Existing group cards -->
  </div>
</section>

<!-- Community Tab -->
<section id="community" class="tab-content" style="display: none;">
  <h2>Community — Stay Informed & Engaged</h2>

  <div id="community-cards" class="card-section">
    <div class="info-card">
      <img src="assets/isidewith-news.jpeg" alt="iSideWith News" class="card-image" />
      <h3>News</h3>
      <p>Trending discussions and news curated by popularity and recency.</p>
      <a href="https://www.isidewith.com/discuss/tags/5ncx/?nasort=popular-today" target="_blank" rel="noopener noreferrer" class="btn">View News</a>
    </div>

    <div class="info-card">
      <img src="assets/isidewith-videos.jpeg" alt="iSideWith Videos" class="card-image" />
      <h3>Videos</h3>
      <p>Watch political clips, debates, and interviews from the community.</p>
      <a href="https://www.isidewith.com/discuss/tags/5ncm/" target="_blank" rel="noopener noreferrer" class="btn">View Videos</a>
    </div>

    <div class="info-card">
      <img src="assets/isidewith-issues.jpeg" alt="iSideWith Issues" class="card-image" />
      <h3>Issues</h3>
      <p>Explore positions and polling across major political issues.</p>
      <a href="https://www.isidewith.com/polls" target="_blank" rel="noopener noreferrer" class="btn">Explore Issues</a>
    </div>

    <div class="info-card">
      <img src="assets/isidewith-discuss.jpeg" alt="iSideWith Discuss" class="card-image" />
      <h3>Discuss</h3>
      <p>Join debates and share perspectives on current political topics.</p>
      <a href="https://www.isidewith.com/discuss/" target="_blank" rel="noopener noreferrer" class="btn">Join Discussion</a>
    </div>
  </div>
</section>

<!-- Voting Tab -->
<section id="voting" class="tab-content" style="display: none;">
  <h2>Voting & Registration</h2>
  <div id="voting-cards"></div>
</section>

<!-- Citizenship & Immigration Tab -->
<section id="citizenship" class="tab-content" style="display: none;">
  <h2>Citizenship & Immigration — Doing it the Right and Legal Way</h2>

  <div id="citizenship-cards"></div>
  <div id="immigration-cards"></div>
  <div id="asylum-cards"></div>
  <div id="study-cards"></div>
  <div id="legal-cards"></div>
  <div id="news-cards"></div>
  <div id="rights-cards"></div>
</section>

</main>
 
  // Show Home Hub tab
function showStartupHub() {
  showTab('startup-hub');
}

// Other tab helpers
function showPodcastsShows() { showTab('podcasts-shows'); }
function showCivic() { showTab('civic'); }
function showPolls() { showTab('polls'); }
function showOrganizations() { showTab('organizations'); }
function showVoting() { showTab('voting'); }

// Generic tab switcher
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.style.display = 'none';
  });
  const tab = document.getElementById(tabId);
  if (tab) tab.style.display = 'block';
}

// Sticky nav buttons scroll to sections
document.addEventListener('DOMContentLoaded', () => {
  const navButtons = document.querySelectorAll('#hub-nav button');
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const section = document.getElementById(btn.dataset?.target);
      if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });

  // Force Home Hub tab to show on page load
  showStartupHub();

  // Hamburger menu
  const hamburger = document.getElementById('hamburger');
  const menu = document.getElementById('hamburger-menu');
  if (hamburger && menu) {
    hamburger.addEventListener('click', e => {
      e.stopPropagation();
      menu.classList.toggle('open');
    });
    document.addEventListener('click', e => {
      if (menu.classList.contains('open') &&
          !menu.contains(e.target) &&
          !hamburger.contains(e.target)) {
        menu.classList.remove('open');
      }
    });
  }

  // Hamburger menu link clicks
  document.querySelectorAll('#hamburger-menu ul li a').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const targetId = link.getAttribute('href')?.substring(1);
      if (!targetId) return;

      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
        tab.hidden = true;
      });

      // Show target tab
      const targetTab = document.getElementById(targetId);
      if (targetTab) {
        targetTab.style.display = 'block';
        targetTab.hidden = false;
      }

      // Tab-specific functions
      if (targetId === 'ratings') {
        if (typeof showRatings === 'function') showRatings();
        if (typeof renderRankingsLeaderboard === 'function') renderRankingsLeaderboard();
      }
      if (targetId === 'my-officials') {
        if (typeof renderOfficials === 'function') {
          renderOfficials(window.selectedState || 'North Carolina', '');
        }
      }

      // Close menu
      menu?.classList.remove('open');
    });
  });
});

// --- Carousel Feed Logic ---
const feeds = {
  world: [
    "https://feeds.reuters.com/reuters/worldNews",
    "https://www.aljazeera.com/xml/rss/all.xml",
    "https://www.theguardian.com/world/rss"
  ],
  finance: [
    "https://www.investing.com/rss/news.rss",
    "https://www.cnbc.com/id/10001147/device/rss/rss.xml",
    "https://feeds.finance.yahoo.com/rss/2.0/headline?s=^DJI"
  ],
  economy: [
    "https://www.investing.com/rss/news_25.rss",
    "https://www.cnbc.com/id/20910258/device/rss/rss.xml",
    "https://www.theguardian.com/business/economics/rss"
  ]
};

async function loadFeed(url) {
  try {
    const response = await fetch(
      `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`
    );
    const data = await response.json();
    return data.items || [];
  } catch {
    return [];
  }
}

function extractImage(item) {
  if (item.thumbnail) return item.thumbnail;
  if (item.enclosure && item.enclosure.link) return item.enclosure.link;
  const match = item.content?.match(/<img[^>]+src="([^">]+)"/i);
  return match?.[1] || "assets/default-thumb.png";
}

async function loadSection(section, containerId) {
  const container = document.getElementById(containerId);
  const track = document.createElement("div");
  track.className = "carousel-track";
  container.appendChild(track);

  const perSourceItems = [];
  for (const url of feeds[section]) {
    const items = await loadFeed(url);
    const mapped = items.map(item => ({ item, img: extractImage(item), source: url }));
    perSourceItems.push(mapped.filter(x => !!x.img));
  }

  const maxCards = 50;
  const result = [];
  let added = 0, index = 0;
  while (added < maxCards) {
    let progressed = false;
    for (let s = 0; s < perSourceItems.length; s++) {
      const sourceList = perSourceItems[s];
      if (index < sourceList.length) {
        result.push(sourceList[index]);
        added++;
        progressed = true;
        if (added >= maxCards) break;
      }
    }
    if (!progressed) break;
    index++;
  }

  result.forEach(({ item, img }) => {
    const card = document.createElement("a");
    card.className = "hub-card carousel-card";
    card.href = item.link;
    card.target = "_blank";
    card.rel = "noopener noreferrer";
    card.innerHTML = `
      <img src="${img}" alt="" class="carousel-img">
      <h3>${item.title}</h3>
      <p>${new Date(item.pubDate).toLocaleDateString()}</p>
    `;
    track.appendChild(card);
  });
}

function setupControls(containerId) {
  const track = document.querySelector(`#${containerId} .carousel-track`);
  const prevBtn = document.querySelector(`.carousel-controls .prev[data-target="${containerId}"]`);
  const nextBtn = document.querySelector(`.carousel-controls .next[data-target="${containerId}"]`);
  let position = 0;
  const step = 310;

  setInterval(() => {
    position++;
    if (position >= track.children.length) position = 0;
    track.style.transform = `translateX(-${position * step}px)`;
  }, 5000);

  prevBtn?.addEventListener("click", () => {
    position = Math.max(0, position - 1);
    track.style.transform = `translateX(-${position * step}px)`;
  });

  nextBtn?.addEventListener("click", () => {
    position = Math.min(track.children.length - 1, position + 1);
    track.style.transform = `translateX(-${position * step}px)`;
  });
}

// Initialize carousels
(async () => {
  await loadSection("world", "world-news-carousel");
  await loadSection("finance", "finance-carousel");
  await loadSection("economy", "economy-carousel");

  setupControls("world-news-carousel");
  setupControls("finance-carousel");
  setupControls("economy-carousel");
})();

  // === State Dropdown ===
const stateSelect = document.getElementById('state-dropdown');
if (stateSelect) {
  // Set initial value
  stateSelect.value = window.selectedState || 'North Carolina';

  // Listen for changes
  stateSelect.addEventListener('change', (e) => {
    window.selectedState = e.target.value;
    console.log("State changed to:", window.selectedState);
    if (typeof renderOfficials === 'function') {
      renderOfficials(window.selectedState, '');
    }
  });
}

// === Force Home Hub on load ===
if (typeof showTab === 'function') {
  showTab('startup-hub');
}
