<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Poliscope</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" />
  <head>
  <script src="cleanHouse.js" defer></script>
  <script src="script-fixed.js" defer></script>
</head>
<body>
  <h1>Poliscope</h1>

  <nav id="tabs">
    <button onclick="showTab('my-officials')">My Officials</button>
    <button onclick="showTab('compare')">Compare</button>
    <button onclick="showTab('top10')">Top 10</button>
    <button onclick="showTab('bottom10')">Bottom 10</button>
    <button onclick="showTab('calendar')">Calendar</button>
    <button onclick="showTab('registration')">Registration</button>
  </nav>

  <input type="text" id="search" placeholder="Search by name, state, or party..." />
  <ul id="results"></ul>

  <label for="state-select">Select your state:</label>
  <select id="state-select">
    <option value="">Choose a state</option>
    <option value="Alabama">Alabama</option>
    <option value="Alaska">Alaska</option>
    <option value="Arizona">Arizona</option>
    <option value="Arkansas">Arkansas</option>
    <option value="California">California</option>
    <option value="Colorado">Colorado</option>
    <option value="Connecticut">Connecticut</option>
    <option value="Delaware">Delaware</option>
    <option value="Florida">Florida</option>
    <option value="Georgia">Georgia</option>
    <option value="Hawaii">Hawaii</option>
    <option value="Idaho">Idaho</option>
    <option value="Illinois">Illinois</option>
    <option value="Indiana">Indiana</option>
    <option value="Iowa">Iowa</option>
    <option value="Kansas">Kansas</option>
    <option value="Kentucky">Kentucky</option>
    <option value="Louisiana">Louisiana</option>
    <option value="Maine">Maine</option>
    <option value="Maryland">Maryland</option>
    <option value="Massachusetts">Massachusetts</option>
    <option value="Michigan">Michigan</option>
    <option value="Minnesota">Minnesota</option>
    <option value="Mississippi">Mississippi</option>
    <option value="Missouri">Missouri</option>
    <option value="Montana">Montana</option>
    <option value="Nebraska">Nebraska</option>
    <option value="Nevada">Nevada</option>
    <option value="New Hampshire">New Hampshire</option>
    <option value="New Jersey">New Jersey</option>
    <option value="New Mexico">New Mexico</option>
    <option value="New York">New York</option>
    <option value="North Carolina">North Carolina</option>
    <option value="North Dakota">North Dakota</option>
    <option value="Ohio">Ohio</option>
    <option value="Oklahoma">Oklahoma</option>
    <option value="Oregon">Oregon</option>
    <option value="Pennsylvania">Pennsylvania</option>
    <option value="Rhode Island">Rhode Island</option>
    <option value="South Carolina">South Carolina</option>
    <option value="South Dakota">South Dakota</option>
    <option value="Tennessee">Tennessee</option>
    <option value="Texas">Texas</option>
    <option value="Utah">Utah</option>
    <option value="Vermont">Vermont</option>
    <option value="Virginia">Virginia</option>
    <option value="Washington">Washington</option>
    <option value="West Virginia">West Virginia</option>
    <option value="Wisconsin">Wisconsin</option>
    <option value="Wyoming">Wyoming</option>
  </select>

  <section id="my-officials">
    <h2>My Officials</h2>
    <div class="card-container" id="my-cards"></div>
  </section>

  <section id="profile-view" style="display:none;"></section>

  <section id="compare" style="display:none;">
    <h2>Compare Officials</h2>
    <div class="compare-selectors">
      <select id="compare-left">
        <option value="">Select official A</option>
      </select>
      <select id="compare-right">
        <option value="">Select official B</option>
      </select>
    </div>
    <div class="compare-results">
      <div id="compare-card-left" class="card"></div>
      <div id="compare-card-right" class="card"></div>
    </div>
  </section>

  <section id="top10" style="display:none;">
    <h2>Top 10 Officials</h2>
    <p>Coming soon: top performers based on attendance, votes, and more.</p>
  </section>

  <section id="bottom10" style="display:none;">
    <h2>Bottom 10 Officials</h2>
    <p>Coming soon: lowest performers based on civic metrics.</p>
  </section>

  <section id="calendar" style="display:none;">
    <h2>Civic Calendar</h2>
    <p>Coming soon: upcoming votes, meetings, and events.</p>
  </section>

  <section id="registration" style="display:none;">
    <h2>Voter Registration Info</h2>
    <p>Coming soon: how to register and vote in your state.</p>
  </section>
  <script src="cleanHouse.js"></script>
<script>
  let allOfficials = []

  function renderCards(data, containerId) {
    const container = document.getElementById(containerId)
    if (!container) return

    const cardsHTML = data.map(person => {
      const imageUrl = person.photo || 'images/fallback.jpg'
      return `
        <div class="card" onclick="expandCard('${person.slug}')">
          <img src="${imageUrl}" alt="${person.name}" onerror="this.src='images/fallback.jpg'" />
          <h3>${person.name}</h3>
          <p>${person.office || person.position || ''}</p>
          <p>${person.state}${person.party ? ', ' + person.party : ''}</p>
          <p>Term: ${person.termStart || '—'} to ${person.termEnd || '—'}</p>
          <p>Approval: ${person.approval || '—'}%</p>
        </div>
      `
    }).join('')
    container.innerHTML = cardsHTML
  }

  function expandCard(slug) {
    const person = allOfficials.find(p => p.slug === slug)
    if (!person) return

    const imageUrl = person.photo || 'images/fallback.jpg'
    const link = person.ballotpediaLink || person.contact?.website || null

    const profileHTML = `
      <div class="card">
        <img src="${imageUrl}" alt="${person.name}" onerror="this.src='images/fallback.jpg'" />
        <h2>${person.name}</h2>
        <p><strong>Office:</strong> ${person.office || person.position || ''}</p>
        <p><strong>State:</strong> ${person.state}</p>
        <p><strong>Party:</strong> ${person.party || '—'}</p>
        <p><strong>Term:</strong> ${person.termStart || '—'} to ${person.termEnd || '—'}</p>
        <p><strong>Approval:</strong> ${person.approval || '—'}%</p>
        ${link ? `<p><a href="${link}" target="_blank">Ballotpedia Profile</a></p>` : ''}
        <p><strong>Platform:</strong> ${person.platform || '—'}</p>
        <p><strong>Bio:</strong> ${person.bio || '—'}</p>
        <p><strong>Contact:</strong> ${person.contact?.email || '—'} | ${person.contact?.phone || '—'} | ${person.contact?.website || '—'}</p>
        <p><strong>Social:</strong> Twitter: ${person.social?.twitter || '—'}, Facebook: ${person.social?.facebook || '—'}, Instagram: ${person.social?.instagram || '—'}</p>
      </div>
    `

    const view = document.getElementById('profile-view')
    view.innerHTML = profileHTML
    view.style.display = 'block'
    window.scrollTo({ top: view.offsetTop, behavior: 'smooth' })
  }

  function renderMyOfficials(state) {
    const matches = allOfficials.filter(person => person.state === state)
    renderCards(matches, 'my-cards')
  }

  function populateCompareDropdowns() {
    const left = document.getElementById('compare-left')
    const right = document.getElementById('compare-right')
    if (!left || !right) return

    left.innerHTML = '<option value="">Select official A</option>'
    right.innerHTML = '<option value="">Select official B</option>'

    allOfficials.forEach(person => {
      const label = `${person.name} (${person.state}${person.party ? ', ' + person.party : ''})`
      const option = new Option(label, person.slug)
      left.add(option.cloneNode(true))
      right.add(option.cloneNode(true))
    })
  }

  function renderCompareCard(slug, containerId) {
    const person = allOfficials.find(p => p.slug === slug)
    const container = document.getElementById(containerId)
    if (!container) return

    if (!person) {
      container.innerHTML = `<p>No match found for: ${slug}</p>`
      return
    }

    const imageUrl = person.photo || 'images/fallback.jpg'
    const link = person.ballotpediaLink || person.contact?.website || null

    container.innerHTML = `
      <div class="card">
        <img src="${imageUrl}" alt="${person.name}" onerror="this.src='images/fallback.jpg'" />
        <h3>${person.name}</h3>
        <p><strong>Office:</strong> ${person.office || person.position || ''}</p>
        <p><strong>State:</strong> ${person.state}</p>
        <p><strong>Party:</strong> ${person.party || '—'}</p>
        <p><strong>Term:</strong> ${person.termStart || '—'} to ${person.termEnd || '—'}</p>
        <p><strong>Approval:</strong> ${person.approval || '—'}%</p>
        ${link ? `<p><a href="${link}" target="_blank">Ballotpedia Profile</a></p>` : ''}
        <p><strong>Platform:</strong> ${person.platform || '—'}</p>
        <p><strong>Contact:</strong> ${person.contact?.email || '—'} | ${person.contact?.phone || '—'} | ${person.contact?.website || '—'}</p>
        <p><strong>Social:</strong> Twitter: ${person.social?.twitter || '—'}, Facebook: ${person.social?.facebook || '—'}, Instagram: ${person.social?.instagram || '—'}</p>
      </div>
    `
  }

  function showTab(id) {
    const sections = ['my-officials', 'compare', 'top10', 'bottom10', 'calendar', 'registration']
    sections.forEach(sectionId => {
      const el = document.getElementById(sectionId)
      if (el) el.style.display = sectionId === id ? 'block' : 'none'
    })
  }

  async function loadData() {
    try {
      const house = window.cleanedHouse || []
      const governors = await fetch('Governors.json').then(res => res.json())
      const senate = await fetch('Senate.json').then(res => res.json())

      allOfficials = [...house, ...governors, ...senate]

      populateCompareDropdowns()

      const stateSelect = document.getElementById('state-select')
      if (stateSelect) {
        stateSelect.value = 'North Carolina'
        renderMyOfficials('North Carolina')

        stateSelect.addEventListener('change', function (e) {
          renderMyOfficials(e.target.value)
        })
      }
    } catch (err) {
      console.error("Error loading data:", err)
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    loadData()

    const left = document.getElementById('compare-left')
    const right = document.getElementById('compare-right')
    const search = document.getElementById('search')

    if (left) {
      left.addEventListener('change', function (e) {
        renderCompareCard(e.target.value, 'compare-card-left')
      })
    }

    if (right) {
      right.addEventListener('change', function (e) {
        renderCompareCard(e.target.value, 'compare-card-right')
      })
    }

    if (search) {
      search.addEventListener('input', function (e) {
        const query = e.target.value.toLowerCase()
        const matches = allOfficials.filter(person =>
          person.name.toLowerCase().includes(query) ||
          person.state.toLowerCase().includes(query) ||
          (person.party && person.party.toLowerCase().includes(query))
        )

        const resultsHTML = matches.map(person => {
          const label = `${person.name} (${person.state}${person.party ? ', ' + person.party : ''})`
          const link = person.ballotpediaLink || person.contact?.website || null

          if (link) {
            return `<li><a href="${link}" target="_blank" rel="noopener noreferrer">${label}</a></li>`
          } else {
            return `<li>${label}</li>`
          }
        }).join('')

        document.getElementById('results').innerHTML = resultsHTML
      })
    }
  })

  window.showTab = showTab
</script>

</body>
</html>
