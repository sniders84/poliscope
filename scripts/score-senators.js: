const fs = require('fs');

const rankingsData = JSON.parse(fs.readFileSync('public/senators-rankings.json', 'utf8'));
const jsonPath = 'public/senators-scores.json';

// Apply scoring weights to raw counts
function calculateScore(sen) {
  let score = 0;

  // Sponsored bills/amendments
  score += sen.sponsoredBills * 1.0;
  score += sen.sponsoredAmendments * 0.5;

  // Cosponsored bills/amendments
  score += sen.cosponsoredBills * 0.5;
  score += sen.cosponsoredAmendments * 0.25;

  // Became law (extra credit)
  score += sen.becameLawBills * 2.0;
  score += sen.becameLawAmendments * 1.0;

  // Committees with leadership bonuses
  if (Array.isArray(sen.committees)) {
    sen.committees.forEach(c => {
      score += 2; // baseline for membership
      if (c.role === 'Ranking') score += 2;
      if (c.role === 'Chairman') score += 4;
    });
  }

  // Missed votes penalty
  score -= sen.missedVotes * 0.5;

  return score;
}

(async () => {
  const output = rankingsData.map(sen => ({
    ...sen,
    powerScore: calculateScore(sen)
  }));

  fs.writeFileSync(jsonPath, JSON.stringify(output, null, 2) + '\n');
  console.log('senators-scores.json fully updated with powerScore!');
})();
